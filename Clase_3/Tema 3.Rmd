---
title: "Introducci√≥n a R "
subtitle: "Funciones y Estructuras condicionales"
author: "Dra.Linda Kempis"
date:  "`r Sys.Date()`"
output:
  xaringan::moon_reader:                 # ¬°Ojo -- nuevo tipo de salida!
    css:
     - default                           # el archivo CSS del tema predeterminado para xaringan
     - rladies                           # el archivo CSS del tema R-Ladies
     - rladies-fonts                     # el archivo CSS de fuentes del tema R-Ladies
    lib_dir: libs                        # crea un directorio para bibliotecas
    #seal: false                          # false: permite crear una diapositiva de t√≠tulo personalizada
    nature:
      highlightStyle: github             # resalta sintaxis para los bloques de c√≥digo
      highlightLines: true               # true: permite resaltar l√≠neas de c√≥digo  
      countIncrementalSlides: false      # false: diapositivas incrementales no aumentar√°n la cuenta
      ratio: "4:3"                       # proporci√≥n: "16:9" para un tama√±o de pantalla ancha
---

```{r xaringan-themer, include=FALSE, warning=FALSE}
library(xaringanthemer)
xaringanExtra::use_clipboard()
style_mono_light(base_color = "#23395b")
```      
---
class: inverse, middle, center

# Funciones
<img src="img_clase_3/function_machine.png" width="50%"
alt="funciones"/>
---

## Funciones

¬øQu√© es una funci√≥n en programaci√≥n?

Una funci√≥n tiene:

üìõ un nombre

üì¶ uno o m√°s argumentos

üß± un cuerpo que define lo que hace

üìå ¬øC√≥mo se define una funci√≥n?

Las funciones definidas por el usuario se crean usando la siguiente estructura:

```{r eval=FALSE}
suma <- function(x, y) {
  resultado <- x + y
  return(resultado)
}
```
---
Partimos del algoritmo para calcular el √°rea de un cuadril√°tero: lado x lado.

Podemos convertir esto a operaciones de R y asignarlas a una funci√≥n llamada area_cuad



```{r}
area_cuad <- function(lado1,lado2) {
  lado1 * lado2
}
```

```{r}
area_cuad(lado1 = 4, lado2 = 6)
area_cuad(4, 6)

```
---
class: inverse, middle, center

# if, else

---
##if, else
.pull-left[
**if** (si) es usado cuando queremos que una operaci√≥n se ejecute √∫nicamente cuando una condici√≥n se cumple.
]
.pull-right[**else** (de otro modo) es usado para indicarle a R qu√© hacer en caso de la condici√≥n de un if no se cumpla.
]

Un if es la manera de decirle a R:

<mark>SI esta condici√≥n es cierta, ENTONCES haz estas operaciones.</mark>.

El modelo para un if es:

```{r eval=FALSE}
if(Condici√≥n) {
operaciones_si_la_condici√≥n_es_TRUE
}
```

Si la condici√≥n se cumple, es decir, es verdadera (TRUE), entonces se realizan las operaciones. En caso contrario, no ocurre nada y el c√≥digo con las operaciones no es ejecutado.
---
Por ejemplo, le pedimos a R que nos muestre el texto ‚ÄúVerdadero‚Äù si la condici√≥n se cumple.

```{r}
# Se cumple la condici√≥n y se muestra "verdadero"
if(10 > 5) {
  "Verdadero"
}
```

```{r}
# No se cumple la condici√≥n y no pasa nada
if(4 > 5) {
  "Verdadero"
}
```


**else** complementa un if, pues indica qu√© ocurrir√° cuando la condici√≥n no se cumple, es falsa (FALSE), en lugar de no hacer nada.


Un **if** con **else** es la manera de decirle a R:


<mark>***SI esta condici√≥n es es cierta, ENTONCES haz estas operaciones, DE OTRO MODO haz estas otras operaciones.***</mark>
---
El modelo para un if con un else es:

```{r eval=FALSE}
if(condici√≥n) {
  operaciones_si_la_condici√≥n_es_TRUE
} else {
  operaciones_si_la_condici√≥n_es_FALSE
}
```
Agregando el else
```{r}
# Se cumple la condici√≥n y se muestra "Verdadero"
if(4 > 5) {
  "Verdadero"
} else {
  "Falso"
}
```

```{r}
# No se cumple la condici√≥n y se muestra "Falso"
if(4 > 5) {
  "Verdadero"
} else {
  "Falso"
}
```
---
<img src="img_clase_3/if_else.png" width="70%"
alt="if_else"/>
---
##Stop
```{r}
dividir <- function(a, b) {
  if (b == 0) {
    stop("Error: No se puede dividir por cero.")
  }
  return(a / b)
}

# Uso:
# dividir(10, 0) # Lanza error: Error: No se puede dividir por cero.

```
<img src="img_clase_3/stop_cat.gif" width="50%"
alt="stop"/>

---
##Usando if y else

üéØ Objetivo:
Para ejemplificar el uso de **if / else**, crearemos una funci√≥n que calcule el promedio de calificaciones de un estudiante y, seg√∫n el resultado, muestre un mensaje espec√≠fico üì©.

üîß Paso 1. Definir funci√≥n de promedio
Primero creamos una funci√≥n que calcule el promedio usando la funci√≥n base mean() de R üìä. M√°s adelante la ampliaremos para incluir l√≥gica condicional.

```{r eval=FALSE}
nombre <- function(argumentos) {
  operaciones
}
```

```{r}
promedio <- function(calificaciones) {
  mean(calificaciones)
}

promedio(c(6, 7, 8, 9))
```
---
Si asumimos que un estudiante necesita obtener 6 o m√°s de promedio para aprobar, podemos decir que:

SI el promedio de un estudiante es igual o mayor a 6, ENTONCES mostrar ‚ÄúAprobado‚Äù, DE OTRO MODO, mostrar ‚ÄúReprobado‚Äù.
Aplicamso esta l√≥gica con un if, else en la funci√≥n promedio()

```{r}
promedio <- function(calificaciones) {
  media <- mean(calificaciones)
  if(media >= 6) {
    "Aprobado"
  } else {
    "Reprobado"
  }
}
promedio <- function(calificaciones){
  media <-mean(calificaciones)
  if(media >=6){
    "Aprobado"
  } else{
    "Reprobado"
  }
}
promedio(c(6, 7, 8, 9, 5))

```
---
Est√° funcionando, aunque los resultados podr√≠an tener una mejor presentaci√≥n.

Usaremos la funci√≥n paste0() para pegar el promedio de calificaciones, como texto, con el resultado de ‚ÄúAprobado‚Äù o ‚ÄúReprobado‚Äù. Esta funci√≥n acepta como argumentos cadenas de texto y las pega (concatena) entre s√≠, devolviendo como resultado una nueva cadena

```{r}
promedio <- function(calificaciones) {
  media <- mean(calificaciones)
  texto <- paste0("Calificaci√≥n: ",media,", ")
  if(media >= 6) {
    paste0(texto, "aprobado")
  } else {
    paste0(texto, "reprobado")
  }
}
promedio(c(5, 8, 5, 6, 5))

```


---
##paste0 o paste
```{r}
#Une las cadenas e incluye un separador entre ellas.

cadena1 <- "Machine"
cadena2 <- "Learning"
resultado <- paste0(cadena1,cadena2)
resultado
```
```{r}
#Funciona de manera similar a paste(), pero no incluye ning√∫n separador entre las cadenas.

cadena1 <- "Data"
cadena2 <- "Science"
resultado <- paste0(cadena1, cadena2)
```

---
class: inverse, middle, center

#ifelse
---
##ifelse
üîÅ La funci√≥n **ifelse()** en R nos permite vectorizar la l√≥gica de if / else, es decir, <mark>aplicar una condici√≥n a todos los elementos de un vector sin necesidad de escribir m√∫ltiples sentencias.</mark>

üìå Cuando intentamos usar una estructura tradicional de **if / else** con un vector, R solo eval√∫a el primer elemento y muestra una advertencia, porque **if** espera una sola condici√≥n l√≥gica.

‚ö° En cambio, con ifelse() obtenemos directamente un resultado para cada elemento del vector seg√∫n si cumple o no la condici√≥n.

```{r eval=FALSE}
if(1:10 < 3) {
  "Verdadero"
}
## Warning in if (1:10 < 3) {: la condici√≥n tiene longitud > 1 y s√≥lo el
## primer elemento ser√° usado
```

En cambio, con ifelse se nos devolver√° un valor para cada elemento de un vector en el que la condici√≥n sea TRUE, adem√°s nos devolver√° otro valor para los elementos en que la condici√≥n sea FALSE

```{r eval=FALSE}
ifelse(vector, valor_si_TRUE, valor_si_FALSE)

```
---
##ifelse
```{r}
ifelse(1:10 < 3,"Verdadero","Falso")
```

```{r}
#Por ejemplo, pedimos s√≥lo los n√∫meros que son exactamente divisibles entre 2 y 3.

num <- 1:20

ifelse(num %% 2 == 0 & num %% 3, "Divisible", "No divisible")
```
---
##ifelse y dataframe
```{r}
#Desde luego, esto es particularmente √∫til para recodificar datos.

tabla_estudiantes <- data.frame(
  Estudiantes=c("Ron","Jake","Ava","Sophia","Mia"),
  Calificaciones=c(3.5,7.5,4.5,3.0,8.5))

tabla_estudiantes

tabla_estudiantes$Resultado =   
  ifelse(tabla_estudiantes$Calificaciones>6,
         "Aprobado","Reprobado")

tabla_estudiantes

```


---
##Ejercicio
```{r}
# Create dataframe
df <- data.frame(id=c(11,22,33,44,55),
                        pages=c(32,45,33,22,56),
                        name=c("spark","python","R","java","jsp"),
                        chapters=c(76,86,11,15,7),
                        price=c(144,553,321,567,890))
df


```
Agrega una nueva columna al dataframe para saber si el libro es peque√±o (Small) o grande(Big).
Sera peque√±o si tiene menos de 20 cap√≠tulos  y m√°s de 10 p√°ginas
---
```{r echo=FALSE }
df$size <- ifelse(df$pages>10 & df$chapters<20,"SMALL","BIG")
df
```
---
class: inverse, middle, center
#Sentencia for

---
##Sentencia for
La instrucci√≥n for itera por los elementos de un vector o lista, ejecutando un conjunto de instrucciones en cada iteraci√≥n. Su sintaxis es:

```{r eval=FALSE}
for (item in vector) {
  conjunto_de_instrucciones
}

for (i in lista) {
  # C√≥digo
}
```

```{r}
for (x in c(20, 4, 6)) {
  print(x)
}

```

```{r}
for (alumno in tabla_estudiantes$Estudiantes) {
  print(alumno)
}
```
---
##Ejercicio

- Realiza un lista de tus frutas favoritas
- Crea un ciclo for para leer la lista
- El ciclo for debe regresar cada fruta de la lista
---
```{r echo=FALSE}
fruits <- list("apple", "banana", "grape")
for (x in fruits) {
  print(x)
}
```


```{r}
for (x in fruits) {
  if (x == "banana") {
    break
  }
  print(x)
}
```
---
class: inverse, middle, center

#Sentencia While

---
##Sentencia While
Este es un tipo de bucle que ocurre mientras una condici√≥n es verdadera (TRUE). La operaci√≥n se realiza hasta que se se llega a cumplir un criterio previamente establecido.
```{r eval=FALSE}
while(condicion) {
  operaciones
}
```
Probemos sumar +1 a un valor, mientras que este sea menor que 5. Al igual que con for, necesitamos la funci√≥n print() para mostrar los resultados en la consola.

```{r}
umbral <- 5
valor <- 0

while(valor < umbral) {
  print("Todav√≠a no.")
  valor <- valor + 1
}
```
---
<img src="img_clase_3/While.png" width="60%"
alt="while"/>

---
## Ejemplo While
### Simulaci√≥n de crecimiento de una poblaci√≥n de c√©lulas en cultivo

Imagina que cada hora las c√©lulas en cultivo aumentan su n√∫mero en un 30 % debido a la divisi√≥n celular. Queremos simular cu√°ntas horas pasan hasta que la poblaci√≥n supera cierto umbral, por ejemplo 50 000 c√©lulas.

```{r}
# Crecimiento celular simulado
poblacion <- 100     # Poblaci√≥n inicial
objetivo <- 50000
horas <- 0

while (poblacion < objetivo) {
  poblacion <- poblacion * 1.3  # Crecimiento del 30%
  horas <- horas + 1
}
mensaje <- paste0(
  "Horas necesarias: ", horas, 
  " |Poblaci√≥n final: ", round(poblacion))
mensaje
```

---
## C√°lculo de la tasa de metabolismo basal

La Tasa de Metabolismo Basal (TMB), es la cantidad m√≠nima de energ√≠a que necesita tu
cuerpo para funcionar. Nunca debemos ingerir menos cantidad de calor√≠as de las que
marca la tasa metab√≥lica. La TMB se calcula siguiendo las siguientes ecuaciones
TMB Mujer = 655 + (9.6 * P) + (1.8 * A) ‚Äì (4.7 * E)
TMB Hombre = 66 + (13.7 * P) + (5 * A) ‚Äì (6.8 * E)
donde necesitamos informaci√≥n del Sexo, A=Altura, P=Peso y E=Edad de cada persona, nuestros argumentos.
---
##üìå Instrucciones del ejercicio:

1. Escribe una funci√≥n en R llamada calcularTMB() que reciba cuatro argumentos:
  * sexo (car√°cter: "hombre" o "mujer")
  * peso (num√©rico, en kg)
  * altura (num√©rico, en cm)
  * edad (num√©rico, en a√±os)

2. Dentro de la funci√≥n, utiliza if / else o ifelse() para decidir qu√© f√≥rmula aplicar seg√∫n el valor de sexo.

3. La funci√≥n debe retornar el valor de la TMB calculado.

4. Luego de definirla, prueba tu funci√≥n con estos datos:

  * Persona A: "mujer", peso = 70 kg, altura = 168 cm, edad = 38 a√±os

  * Persona B: "hombre", peso = 78 kg, altura = 167 cm, edad = 40 a√±os

üîé Opcional: modifica la funci√≥n para que, adem√°s de retornar el valor num√©rico de la TMB, muestre un mensaje indicando la cantidad m√≠nima de calor√≠as que esa persona necesita, por ejemplo:

‚Äú Tu TMB es 1451 kcal/d√≠a ‚Äî no deber√≠as consumir menos que esto.‚Äù
---
```{r echo=FALSE}
# üìä Funci√≥n para calcular TMB
calcularTMB <- function(sexo, peso, altura, edad) {
  
  # Convertir a min√∫sculas por si el usuario escribe "Hombre" o "MUJER"
  sexo <- tolower(sexo)
  
  # üß† Validar el sexo y aplicar la f√≥rmula adecuada
  if (sexo == "hombre") {
    # F√≥rmula para hombre
    tmb <- 66 + (13.7 * peso) + (5 * altura) - (6.8 * edad)
  } else if (sexo == "mujer") {
    # F√≥rmula para mujer
    tmb <- 655 + (9.6 * peso) + (1.8 * altura) - (4.7 * edad)
  } else {
    stop("‚ö†Ô∏è Sexo no v√°lido. Usa 'hombre' o 'mujer'.")
  }
  
  # Retornar el resultado
  #return(tmb)
  return(paste(
  "Tu TMB es", tmb,
  "kcal/d√≠a ‚Äî no deber√≠as consumir menos que esto.")
  )

}
```
---
```{r}
# ‚ôÄÔ∏è Mujer de ejemplo
tmb_mujer <- calcularTMB("mujer", 70, 168, 38)
tmb_mujer
# ‚ôÇÔ∏è Hombre de ejemplo
tmb_hombre <- calcularTMB("hombre", 78, 167, 40)
tmb_hombre
```
---
##Referencias

- https://bookdown.org/jboscomendoza/r-principiantes4/estructuras-de-control.html
- https://rpubs.com/ydmarinb/429756
- https://r-coder.com/grepl-grep-en-r/
- https://www.digitalocean.com/community/tutorials/sub-and-gsub-function-r